# -*- coding: utf-8 -*-
"""Untitled155.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1XWgiKagfxvheyrGFDeweQCTnkjO8QC6P
"""

from fastapi import FastAPI, Request, Form
from fastapi.responses import HTMLResponse
from fastapi.templating import Jinja2Templates
import joblib
import numpy as np

# Initialize app and load model
app = FastAPI(title="House Price Web App")
model = joblib.load("model/house_price_model.pkl")

# Load HTML templates
templates = Jinja2Templates(directory="templates")

@app.get("/", response_class=HTMLResponse)
def home(request: Request):
    return templates.TemplateResponse("index.html", {"request": request, "result": None})

@app.post("/predict", response_class=HTMLResponse)
def predict(
    request: Request,
    MedInc: float = Form(...),
    HouseAge: float = Form(...),
    AveRooms: float = Form(...),
    AveBedrms: float = Form(...),
    Population: float = Form(...),
    AveOccup: float = Form(...),
    Latitude: float = Form(...),
    Longitude: float = Form(...)
):
    X = np.array([[MedInc, HouseAge, AveRooms, AveBedrms, Population, AveOccup, Latitude, Longitude]])
    prediction = model.predict(X)[0]
    return templates.TemplateResponse("index.html", {
        "request": request,
        "result": round(float(prediction), 3)
    })